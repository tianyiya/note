## 一、当前读、快照读

### 当前读

当前读，总是读取已经提交完成的最新版本

```text
update
select lock in share mode
select for update
```

### 快照读

根据 row trx_id 和一致性视图确定数据版本的可见性


## 二、读已提交、可重复度

### MVCC

通过undo log，维护一个数据的多个版本，每个版本有个trx_id

### 一致性视图

为每个事务构造一个数组，数组中保存已经开启但没有提交的事务。

记数组中最新的事务ID为低水位，系统创建过的最大事务的ID+1为高水位，当前事务ID为cur_trx

1. 低水位) & cur_trx 表示已经提交的事务或当前事务，数据版本可见
2. [高水位 表示未提交的事务，不可见
3. [低水位,高水位)，如果不在数组中，则表示已提交，可见；在数组中，未提交，不可见

## 读已提交

每个语句执行前都创建一致性视图

## 可重复度

仅事务开始的时候创建一次一致性视图

## 事务开启的时机

begin/start transaction 命令并不是一个事务的起点，在执行到它们之后的第一个操作 InnoDB 表的语句，事务才真正启动。
要马上启动一个事务，可以使用 start transaction with consistent snapshot 这个命令，仅在可重复度级别下有用