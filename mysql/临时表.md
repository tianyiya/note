## 概念

内存表，指的是使用 Memory 引擎的表，建表语法是 create table … engine=memory。这种表的数据都保存在内存里，系统重启的时候会被清空，但是表结构还在。除了这两个特性看上去比较“奇怪”外，从其他的特征上看，它就是一个正常的表。

而临时表，可以使用各种引擎类型 。如果是使用 InnoDB 引擎或者 MyISAM 引擎的临时表，写数据的时候是写到磁盘上的。当然，临时表也可以使用 Memory 引擎。

## 特点

```text
建表语法是 create temporary table …。

一个临时表只能被创建它的 session 访问，对其他线程不可见。所以，图中 session A 创建的临时表 t，对于 session B 就是不可见的。

临时表可以与普通表同名。

session A 内有同名的临时表和普通表的时候，show create 语句，以及增删改查语句访问的是临时表。

show tables 命令不显示临时表。
```

## 应用

### 分库分表查询结果聚合

### union

### group by

## 主备复制

#sql{进程 id}_{线程 id}_ 序列号

如果当前的 binlog_format=row，那么跟临时表有关的语句，就不会记录到 binlog 里。也就是说，只在 binlog_format=statment/mixed 的时候，binlog 中才会记录临时表的操作。

这种情况下，创建临时表的语句会传到备库执行，因此备库的同步线程就会创建这个临时表。主库在线程退出的时候，会自动删除临时表，但是备库同步线程是持续在运行的。

这时候我们就需要在主库上再写一个 DROP TEMPORARY TABLE 传给备库执行

```text
DROP TABLE `t_normal` /* generated by server */
```

MySQL 在记录 binlog 的时候，会把主库执行这个语句的线程 id 写到 binlog 中。

这样，在备库的应用线程就能够知道执行每个语句的主库线程 id，并利用这个线程 id 来构造临时表的 table_def_key

## 内存临时表与磁盘临时表

内存临时表能放下就用内存临时表， 内存临时表的大小是有限制的，参数 tmp_table_size 就是控制这个内存大小的，默认是 16M。

否则使用磁盘临时表，磁盘临时表默认使用的引擎是 InnoDB

