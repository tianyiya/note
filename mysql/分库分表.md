# 一、方案

## （一）、从库法

适用于表结构不变，双倍扩容

1. 添加一个VIP B到主库
2. 添加分库分表规则，当然，此时VIP A和VIP B均操作主库
3. 停写，通过配置，停止写入
4. 待从库追赶上之后，从库升级为主，并添加新的主从，切换VIP B到新的主库，并开启写入

##  （二）、双写法

1. 开启双写，以主库是否成功为事务是否成功的依据

对于插入操作，插入就好了
对于删除操作，双写需要写入墓碑消息，存量同步时，墓碑消息不同步
对于修改操作，如果新库没有，则查询老库后插入

2. 存量数据同步，同步到双写之后的一个时间点，已确保数据全部同步

仅需要插入新库不存在的数据，包括双写后新库插入的、修改的以及删除的

3. 数据校验，全量校验及实时校验

## （三）、binlog同步

1. 开启双向同步，先不消费kafka
2. 同步存量数据
3. 开启kafka，消费数据
4. 灰度切流，切流前先短暂停写，保证kafka消费完
5. 关闭停写
