服务端需要判定消息是否重复，避免消息的重复下发

常用方案如下：

1. 客户端唯一序列号。如果服务端已接受过该序列号，则判定为重复消息
2. 时间戳。判定时间戳是否重复，或时间戳是否小于服务端保存的最大时间戳

客户端唯一序列号的方式，如果客户端卸载重装，可能序列号清空。
所以，可能这个序列号需要包含一个时间属性，而不仅仅是数字。

当然，毕竟卸载是很特殊的情况。

服务端如何维护判重数据？

使用内存还是分布式缓存？

很明显，如果使用内存，则服务宕机数据丢失。

如果使用分布式缓存，则也存在一致性问题

具体来说，消息到来时，服务端可以做如下处理

0. 判重
1. 保存消息
2. 设置判重数据

或

0. 判重
1. 设置判重数据
2. 保存消息

无论哪种，都将出现问题，要么消息重复，要么出现消息丢失。

我的想法是，判重数据结构如下所示

```text
uid_device_seq  msgId
```

无论哪种方案，比如使用方案二， 
判重如果不重复，则获取msgId，然后设置判重数据，最后保存消息，设置判重异常则直接失败，此时可能判重数据已经设置。
如果重复，则需要获取到msgId，保存消息时，如果msgId重复则保存失败。




