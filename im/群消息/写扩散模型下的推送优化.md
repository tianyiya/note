# 一、重要消息单独通道

# 二、批量操作

批量获取路由及在线状态

# 三、异步写离线消息

1. 批量写入MQ，同时开启延迟推送任务
2. 服务端收到ACK后，删除离线消息（或设置为已ACK），要确保时序性，确保离线消息已写入
3. 延迟推送时间到达后，推送未ACK的离线消息




# Q&A


> 延迟任务框架，比如XXL-JOB、Elastic-Job等

> 如何保证ACK和离线消息的时序性

按群ID为分区键

> 何时返回给发送端ACK

接入层将消息传递给dispatcher，dispatcher写入MQ后即返回ACK



