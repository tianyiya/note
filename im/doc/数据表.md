# 表结构

## 用户表

- 用户ID
- 用户名

## 单聊

### 好友关系表

- 用户A
- 用户B
- black
- status（用户A是否删除了用户B）
- sequence（用户A的好友关系序列号）

### 好友申请表

- 用户A
- 用户B
- remark（请求消息）
- 审批状态（是否同意了申请或拒绝了申请）
- status（是否删除了该申请）
- sequence

### 单聊消息表

- 消息ID
- 消息序列号
- 消息类型（文本、图片、语音等）
- 消息发送方
- 消息接收方
- 消息详情
- 消息时间戳

### 消息索引表

- 用户A
- 用户B
- 是否是收件箱（相对于用户A来说）
- 消息ID

### 会话表

- 会话ID（根据用户A和用户B生成，两个用户的会话ID是否要一致？）
- 用户A
- 用户B
- 最新消息ID
- 未读数
- 会话序列号（用于增量拉取）
- 已读消息序列号

## 群聊

### 群组表

- groupId
- groupName
- sequence
- delFlag


# 二、读写模型

## （一）、 写扩散

写扩散方便读取，比如user1查询和user2的两天记录，仅需要查询

```dtd
select * from 消息索引表 where user1 = 'user1' and user2 = 'user2';
```

也可以很方便的对消息进行定制功能，比如删除、收藏、已读标记等

但写扩散对存储的压力大

## （二）、 读扩散

