# 一、表结构

## （一）、用户表

- 用户ID
- 用户名

## （二）、 单聊消息表

- 消息ID
- 消息序列号（会话级别）
- 消息类型
- 消息发送方
- 消息接收方
- 消息详情
- 消息时间戳

## （三）、消息索引表

- user1
- user2
- 是否是收件箱
- 消息ID

为每个用户存储一份消息，即写扩散

## （四）、会话表

- 会话ID
- user1
- user2
- 消息ID
- 未读数
- 消息序列号（会话级别最新序列号）
- 已读消息序列号（会话级别最新序列号）

## （五）、好友关系表

- 应用ID
- fromId
- toId
- sequence
- remark
- status
- black
- extra

## （六）、好友申请表

- 应用ID
- fromId
- toId
- remark
- 审批状态
- sequence
- delFlag

## 群组表

- 应用ID
- groupId
- groupName
- sequence
- delFlag


# 二、读写模型

## （一）、 写扩散

写扩散方便读取，比如user1查询和user2的两天记录，仅需要查询

```dtd
select * from 消息索引表 where user1 = 'user1' and user2 = 'user2';
```

也可以很方便的对消息进行定制功能，比如删除、收藏、已读标记等

但写扩散对存储的压力大

## （二）、 读扩散

