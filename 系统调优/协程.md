# 一、优势

轻量级线程

占用内存小

创建开销小

切换不需要系统调用

可以以同步的编程方式而保持异步的运行机制，从而提高开发效率，又能实现高并发

# 二、实现并发的方式

## （一）、多进程

内核维护成本高，且无法通过共享内存的方式同步数据

## （二）、线程

可以通过共享内存的方式同步数据，但同时由于共享地址空间多线程之间会相互影响

创建线程的代价也是比较高的，每个线程需要8MB的栈内存及64MB的内存池

上下文切换的成本高，当调用阻塞方法时，为了充分利用CPU，会切换其它线程运行，需要由用户态切换到内核态

## （三）、多路复用器

通过非阻塞的方式拆分为两个函数，一个是用户显示调用，一个是多路复用器调用。 通过注册回调函数完成通知切换线程。

不易编程，且容易出错

## （四）、协程

同多路复用器，使用非阻塞的系统调用与内核交互，把切换的权利掌握在用户态代码中

但协程是把异步化中的两个函数，封装为了一个阻塞的协程调用，通过协程框架完成协程的切换及系统调用，当函数结果满足后，协程框架再选择时机重新调度

# 三、如何实现协程切换

CPU中栈寄存器SP指向当前线程的栈地址，指令寄存器IP指向下一条要执行的指令地址

当要执行切换时，首先保存当前线程的SP和IP，再从内存中找出待执行线程的寄存器只写入CPU，从而实现线程切换